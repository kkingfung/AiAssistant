<Window x:Class="AiAssistant.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="AiAssistant" Width="300" Height="400"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        ShowInTaskbar="False"
        ResizeMode="NoResize"
        WindowStartupLocation="Manual"
        MouseLeftButtonDown="Window_MouseLeftButtonDown"
        MouseRightButtonUp="Window_MouseRightButtonUp">

    <Window.Resources>
        <!-- ドロップシャドウエフェクト -->
        <DropShadowEffect x:Key="DropShadowEffect"
                         Color="Black"
                         Opacity="0.3"
                         BlurRadius="10"
                         ShadowDepth="2"/>
    </Window.Resources>

    <Grid>
        <!-- ボタンパネル（右上） -->
        <StackPanel Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Margin="5">
            <!-- チャットボタン -->
            <Button Content="💬"
                    Width="28"
                    Height="28"
                    Margin="0,0,5,0"
                    Background="#88000000"
                    Foreground="White"
                    BorderThickness="0"
                    FontSize="16"
                    Cursor="Hand"
                    Click="OnChatButtonClick">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}"
                                            CornerRadius="14">
                                        <ContentPresenter HorizontalAlignment="Center"
                                                         VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#CC1E90FF"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <!-- 閉じるボタン -->
            <Button Content="×"
                    Width="28"
                    Height="28"
                    Background="#88000000"
                    Foreground="White"
                    BorderThickness="0"
                    FontSize="18"
                    FontWeight="Bold"
                    Cursor="Hand"
                    Click="OnCloseButtonClick">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}"
                                            CornerRadius="14">
                                        <ContentPresenter HorizontalAlignment="Center"
                                                         VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#CCFF0000"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </StackPanel>

        <!-- キャラクター表示エリア（ドラッグ可能） -->
        <Border x:Name="CharacterBorder"
                Width="280" Height="340"
                CornerRadius="12"
                HorizontalAlignment="Center" VerticalAlignment="Bottom"
                Background="Transparent"
                Padding="8"
                Margin="0,50,0,10"
                MouseLeftButtonDown="Window_MouseLeftButtonDown"
                Cursor="SizeAll">
            <Grid>
                <!-- 3Dキャラクタープレースホルダー -->
                <Viewbox Stretch="Uniform">
                    <Grid Width="200" Height="260">
                        <!-- プレースホルダー：円形アバター -->
                        <Ellipse Width="100" Height="100"
                                Fill="LightGray"
                                Opacity="0.3"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"
                                Margin="0,0,0,60"/>

                        <!-- プレースホルダー：テキスト -->
                        <TextBlock Text="AI助理"
                                  Foreground="Gray"
                                  FontWeight="Bold"
                                  FontSize="18"
                                  Opacity="0.5"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Bottom"
                                  Margin="0,0,0,20"/>

                        <!-- 状態インジケーター -->
                        <TextBlock x:Name="StateIndicator"
                                  Text="{Binding StateText}"
                                  Foreground="White"
                                  FontSize="12"
                                  Opacity="0.7"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Bottom"
                                  Margin="0,0,0,2"/>
                    </Grid>
                </Viewbox>
            </Grid>
        </Border>

        <!-- チャットバルーンポップアップ -->
        <Border x:Name="ChatBalloon"
                Width="280"
                Height="180"
                HorizontalAlignment="Left"
                VerticalAlignment="Bottom"
                Margin="10,0,0,10"
                Background="#F0FFFFFF"
                CornerRadius="12"
                Padding="0"
                Visibility="Collapsed"
                IsHitTestVisible="True"
                Effect="{StaticResource DropShadowEffect}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- ヘッダー -->
                <Border Grid.Row="0"
                        Background="#FF1E90FF"
                        CornerRadius="12,12,0,0"
                        Padding="12,8">
                    <Grid>
                        <TextBlock Text="チャット"
                                  Foreground="White"
                                  FontWeight="Bold"
                                  FontSize="14"
                                  VerticalAlignment="Center"/>
                        <Button Content="×"
                                Width="24"
                                Height="24"
                                HorizontalAlignment="Right"
                                Background="Transparent"
                                BorderThickness="0"
                                Foreground="White"
                                FontSize="16"
                                FontWeight="Bold"
                                Cursor="Hand"
                                Click="OnCloseChatClick"/>
                    </Grid>
                </Border>

                <!-- メッセージ表示エリア -->
                <ScrollViewer Grid.Row="1"
                             x:Name="ChatScrollViewer"
                             VerticalScrollBarVisibility="Auto"
                             Padding="12">
                    <StackPanel x:Name="ChatMessagesPanel"
                               Orientation="Vertical"/>
                </ScrollViewer>

                <!-- 入力エリア -->
                <Border Grid.Row="2"
                        Background="#FFF5F5F5"
                        CornerRadius="0,0,12,12"
                        Padding="12"
                        BorderBrush="#FFDDDDDD"
                        BorderThickness="0,1,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0"
                                BorderBrush="#FFCCCCCC"
                                BorderThickness="1"
                                CornerRadius="4">
                            <TextBox x:Name="ChatInputBox"
                                    MinHeight="32"
                                    MaxHeight="100"
                                    Padding="8"
                                    VerticalAlignment="Center"
                                    TextWrapping="Wrap"
                                    AcceptsReturn="False"
                                    BorderThickness="0"
                                    Background="White"
                                    IsEnabled="True"
                                    Focusable="True"
                                    KeyDown="OnChatInputKeyDown"/>
                        </Border>

                        <Border Grid.Column="1"
                                Margin="8,0,0,0"
                                Background="#FF1E90FF"
                                CornerRadius="4"
                                Cursor="Hand">
                            <Button x:Name="SendButton"
                                    Content="送信"
                                    Width="60"
                                    Height="32"
                                    Background="Transparent"
                                    Foreground="White"
                                    BorderThickness="0"
                                    FontWeight="Bold"
                                    Cursor="Hand"
                                    Click="OnSendMessageClick"/>
                        </Border>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- 暫態訊息顯示區域 -->
        <Border x:Name="TransientBorder"
                HorizontalAlignment="Center" VerticalAlignment="Top"
                Margin="0,10,0,0"
                Background="#DD000000"
                CornerRadius="6"
                Padding="12,6"
                Visibility="Collapsed">
            <TextBlock x:Name="TransientMessage"
                       Foreground="White"
                       FontSize="12"
                       Text=""/>
        </Border>
    </Grid>
</Window>